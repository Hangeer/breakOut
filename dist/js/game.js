"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();$(document).ready(function(t){var i=t||window.event;i.preventDefault;var e={canvas:document.querySelector("#canvas"),context:document.querySelector("#canvas").getContext("2d"),timer:null,stopTimer:function(){window.clearInterval(this.timer)}},s=function(){function t(){_classCallCheck(this,t),this.context=e.context,this.startX=0,this.startY=0,this.width=320,this.height=568,this.upFlag=!1,this.upPosLow=250}return _createClass(t,[{key:"refresh",value:function(){this.context.clearRect(this.startX,this.startY,this.width,this.height)}},{key:"up",value:function(t){this.upFlag=t<this.upPosLow,this.upFlag&&(this.context.translate(0,3),this.upPosLow-=3,this.startY-=3)}},{key:"run",value:function(){e.timer=window.setInterval(function(){l.refresh(),u.fall(),a.rotate(),c.rotate(),r.move(),l.up(u.top),u.collision(a.testPoint.down.y,a.testPoint.down.status),u.collision(a.testPoint.up.y,a.testPoint.up.status),u.collision(c.testPoint.down.y,a.testPoint.down.status),u.collision(c.testPoint.up.y,a.testPoint.up.status),u.collision(r.top,r.isClose)},100/6),$(document).on("touchstart",function(){u.jump()})}}]),t}(),n=function(){function t(i,e,s,n,o,h){_classCallCheck(this,t),this.context=i,this.width=e,this.height=s,this.top=n,this.left=o,this.img=h,this.timer=null,this.exp=.1}return _createClass(t,[{key:"paint",value:function(){this.context.drawImage(this.img,this.left,this.top)}},{key:"jump",value:function(){this.exp=-5}},{key:"fall",value:function(){this.top+=this.exp,this.exp+=.2,this.paint(),this.isEnd()}},{key:"isEnd",value:function(){this.top>600&&(console.log("Fall down game over"),e.stopTimer())}},{key:"getPos",value:function(){return[this.left+this.width/2,this.top+this.height/2]}},{key:"collision",value:function(t,i){var s=this.getPos()[1];Math.abs(t-s)<5&&i&&(console.log("collision"),console.log("game over"),e.stopTimer())}}]),t}(),o=function(){function t(i,e,s,n,o,h,a,c,r){_classCallCheck(this,t),this.context=i,this.start={x:e,y:s},this.width=n,this.height=o,this.img=h,this.rotateDeg=a,this.initDegree=a,this.testPoint={up:{y:this.start.y,zone:c,status:!0},down:{y:this.start.y+this.height,zone:r,status:!0}}}return _createClass(t,[{key:"paint",value:function(){this.context.save(),this.context.translate(this.start.x+.5*this.width,this.start.y+.5*this.height),this.context.rotate(this.rotateDeg),this.context.drawImage(this.img,-.5*this.width,-.5*this.height),this.context.restore()}},{key:"rotate",value:function(){this.context.save(),this.context.translate(this.start.x+.5*this.width,this.start.y+.5*this.height),this.context.rotate(this.rotateDeg),this.context.clearRect(-.5*this.width,-.5*this.height,this.width,this.height),this.context.restore(),this.rotateDeg+=.02,this.rotateDeg>=2*Math.PI+this.initDegree&&(this.rotateDeg=this.initDegree),this.testPoint.up.status=!(this.rotateDeg>=this.testPoint.up.zone[0]&&this.rotateDeg<=this.testPoint.up.zone[1]),this.testPoint.down.status=!(this.rotateDeg>=this.testPoint.down.zone[0]&&this.rotateDeg<=this.testPoint.down.zone[1]),this.paint(),u.paint()}}]),t}(),h=function(){function t(i,e,s,n,o,h,a){_classCallCheck(this,t),this.context=i,this.width=e,this.height=s,this.img=n,this.direction=o,this.left=h,this.top=a,this.isClose=!0}return _createClass(t,[{key:"paint",value:function(){this.context.drawImage(this.img,this.left,this.top)}},{key:"move",value:function(){this.context.clearRect(this.left,this.top,this.width,this.height),this.isClose=this.left>140,(this.direction&&this.left+this.width/2>=160||!this.direction&&this.left-this.width/2<=20)&&(this.direction=!this.direction),this.direction?this.left+=1:this.left-=1,this.paint()}}]),t}(),a=new o(e.context,60,50,200,200,document.querySelector("#circle"),0,[3.5,4.9],[.3,1.8]),c=new o(e.context,60,-350,200,200,document.querySelector("#circle"),0,[3.5,4.9],[.3,1.8]),r=new h(e.context,20,20,document.querySelector("#block"),!0,100,-450);a.paint(),c.paint(),r.paint();var l=new s,u=new n(e.context,20,20,400,150,document.querySelector("#block"));u.paint(),l.run()});